
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –ß–µ–∫-–ª–∏—Å—Ç</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .workout-tab.active {
            @apply bg-blue-600 text-white;
        }
        .workout-day {
            display: none;
        }
        .workout-day.active {
            display: block;
        }
        .history-item {
            transition: all 0.2s ease;
        }
        .history-item:hover {
            transform: translateX(4px);
        }
        .file-upload {
            border: 2px dashed #cbd5e1;
            transition: all 0.3s ease;
        }
        .file-upload:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }
        .file-upload.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">–¢—Ä–µ–Ω—É–≤–∞–ª—å–Ω–∏–π –ß–µ–∫-–ª–∏—Å—Ç</h1>
            <p class="text-gray-600">–í—ñ–¥—Å—Ç–µ–∂—É–π—Ç–µ —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å —Ç–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–±—É–≤–∞–π—Ç–µ!</p>
        </div>

        <!-- Program Management -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üìÅ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—Ä–æ–≥—Ä–∞–º–æ—é —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</h2>
            
            <!-- File Upload Area -->
            <div class="file-upload rounded-lg p-6 text-center mb-4" id="fileUpload">
                <div class="space-y-3">
                    <div class="text-4xl">üìÑ</div>
                    <div>
                        <p class="text-gray-700 font-medium">–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ CSV —Ñ–∞–π–ª –∑ –ø—Ä–æ–≥—Ä–∞–º–æ—é —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</p>
                        <p class="text-gray-500 text-sm">–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª —Å—é–¥–∏ –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É</p>
                    </div>
                    <input type="file" id="csvFileInput" accept=".csv" class="hidden">
                    <button onclick="document.getElementById('csvFileInput').click()" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        –í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª
                    </button>
                </div>
            </div>
            
            <!-- Control Buttons -->
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="downloadDefaultCSV()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–∏–∫–ª–∞–¥ CSV
                </button>
                <button onclick="loadDefaultProgram()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                    üîÑ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞
                </button>
                <button onclick="clearProgram()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º—É
                </button>
            </div>
        </div>

        <!-- Pre-workout reminders -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" id="preWorkoutSection">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üî• –ó–∞–≥–∞–ª—å–Ω—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–∏–º —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è–º:</h2>
            <div class="space-y-2" id="preWorkoutReminders">
                <!-- Will be populated dynamically -->
            </div>
        </div>

        <!-- Workout tabs -->
        <div class="flex flex-wrap justify-center mb-6" id="workoutTabs">
            <!-- Will be populated dynamically -->
        </div>

        <!-- Workout content -->
        <div id="workoutContent">
            <!-- Will be populated dynamically -->
        </div>

        <!-- Post-workout reminders -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6" id="postWorkoutSection">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">üìù –ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è:</h2>
            <div class="space-y-2" id="postWorkoutReminders">
                <!-- Will be populated dynamically -->
            </div>
        </div>

        <!-- Progress tracking with date -->
        <div class="bg-white rounded-lg shadow-md p-6 mt-6">
            <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-4 gap-4">
                <h2 class="text-xl font-semibold text-gray-800">üìä –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è</h2>
                <div class="flex flex-col sm:flex-row gap-2">
                    <input type="date" id="workoutDate" class="px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <div class="flex gap-2">
                        <button onclick="saveWorkout()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            üíæ –ó–±–µ—Ä–µ–≥—Ç–∏
                        </button>
                        <button onclick="loadWorkout()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                            üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                        </button>
                        <button onclick="showHistory()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                            üìà –Ü—Å—Ç–æ—Ä—ñ—è
                        </button>
                    </div>
                </div>
            </div>
            <p class="text-gray-600 text-sm">
                –í–∏–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ –∑–±–µ—Ä–µ–∂—ñ—Ç—å —Å–≤—ñ–π –ø—Ä–æ–≥—Ä–µ—Å. –ö–æ–∂–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –∑–∞ –¥–∞—Ç–æ—é.
            </p>
        </div>

        <!-- History Modal -->
        <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
                    <div class="flex justify-between items-center p-6 border-b">
                        <h2 class="text-2xl font-bold text-gray-800">üìà –Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</h2>
                        <button onclick="closeHistory()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[70vh]">
                        <div id="historyContent" class="space-y-4">
                            <!-- History content will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-gray-500">
            <p>üí™ –£—Å–ø—ñ—Ö—ñ–≤ —É —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è—Ö! –ë—É–¥—å—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–º–∏ —Ç–∞ –¥–æ—Å—è–≥–∞–π—Ç–µ —Å–≤–æ—ó—Ö —Ü—ñ–ª–µ–π!</p>
        </div>
    </div>

    <script>
        let currentProgram = null;
        let currentActiveDay = 1;

        // Set today's date as default
        document.getElementById('workoutDate').valueAsDate = new Date();

        // Default workout program data
        const defaultProgram = {
            preWorkout: [
                "–†–æ–∑–º–∏–Ω–∫–∞ (5-10 —Ö–≤–∏–ª–∏–Ω): –õ–µ–≥–∫–µ –∫–∞—Ä–¥—ñ–æ –Ω–∞ —Å—Ç–µ–ø–µ—Ä—ñ (3-5 —Ö–≤–∏–ª–∏–Ω), –¥–∏–Ω–∞–º—ñ—á–Ω–∞ —Ä–æ–∑—Ç—è–∂–∫–∞",
                "–ü—ñ–¥–≥–æ—Ç—É–≤–∞—Ç–∏ –≤–æ–¥—É",
                "–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏—Å—è –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è!"
            ],
            postWorkout: [
                "–†–µ—Ç–µ–ª—å–Ω–æ —Ä–æ–∑—Ç—è–≥–Ω—É—Ç–∏ –≤—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –≥—Ä—É–ø–∏ –º'—è–∑—ñ–≤",
                "–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –≤–æ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å",
                "–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ —è–∫—ñ—Å–Ω–µ —Ö–∞—Ä—á—É–≤–∞–Ω–Ω—è –¥–ª—è –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è"
            ],
            days: [
                {
                    name: "–î–µ–Ω—å 1: –¢—è–≥–æ–≤—ñ —Ä—É—Ö–∏ —Ç–∞ –Ω–æ–≥–∏",
                    exercises: [
                        {
                            name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç—É—Ä–Ω—ñ–∫—É (—à–∏—Ä–æ–∫–∏–º —Ö–≤–∞—Ç–æ–º –¥–æ –≥—Ä—É–¥–µ–π)",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è –Ω–∞ —Ç—É—Ä–Ω—ñ–∫—É (–∑–≤–æ—Ä–æ—Ç–Ω–∏–º —Ö–≤–∞—Ç–æ–º)",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è –∫–ª–∞—Å–∏—á–Ω—ñ",
                            sets: 3,
                            type: "reps",
                            recommended: "10-15"
                        },
                        {
                            name: "–í–∏–ø–∞–¥–∏ (–ø–æ —á–µ—Ä–∑—ñ –Ω–∞ –∫–æ–∂–Ω—É –Ω–æ–≥—É)",
                            sets: 3,
                            type: "reps",
                            recommended: "10-12 –Ω–∞ –Ω–æ–≥—É"
                        },
                        {
                            name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è –≤—ñ–¥ –ø—ñ–¥–ª–æ–≥–∏ –∫–ª–∞—Å–∏—á–Ω—ñ",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ü—ñ–¥–π–æ–º–∏ –Ω—ñ–≥ —É –≤–∏—Å—ñ –Ω–∞ —Ç—É—Ä–Ω—ñ–∫—É",
                            sets: 3,
                            type: "reps",
                            recommended: "10-15"
                        },
                        {
                            name: "–°—Ç–µ–ø–µ—Ä (–ø–æ–º—ñ—Ä–Ω–∏–π —Ç–µ–º–ø) - 10-15 —Ö–≤–∏–ª–∏–Ω",
                            type: "checkbox"
                        },
                        {
                            name: "–ó–∞–º–∏–Ω–∫–∞ —Ç–∞ —Ä–æ–∑—Ç—è–∂–∫–∞ (10-15 —Ö–≤–∏–ª–∏–Ω)",
                            type: "checkbox"
                        }
                    ]
                },
                {
                    name: "–î–µ–Ω—å 2: –ñ–∏–º–æ–≤—ñ —Ä—É—Ö–∏ —Ç–∞ –≤–∏–±—É—Ö–æ–≤–∞ —Å–∏–ª–∞",
                    exercises: [
                        {
                            name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è –Ω–∞ –±—Ä—É—Å–∞—Ö",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ê–≤—Å—Ç—Ä–∞–ª—ñ–π—Å—å–∫—ñ –ø—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ó–∞—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–∞ —Å—Ç–µ–ø–µ—Ä/–ø–ª–∞—Ç—Ñ–æ—Ä–º—É",
                            sets: 3,
                            type: "reps",
                            recommended: "8-12"
                        },
                        {
                            name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è –∑ –≤—É–∑—å–∫–æ—é –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–æ—é —Ä—É–∫ (–∞–ª–º–∞–∑–Ω—ñ)",
                            sets: 3,
                            type: "reps"
                        },
                        {
                            name: "–ü–ª–∞–Ω–∫–∞ –∫–ª–∞—Å–∏—á–Ω–∞",
                            sets: 3,
                            type: "time",
                            recommended: "30-60 —Å–µ–∫"
                        },
                        {
                            name: "–ü–ª–∞–Ω–∫–∞ –±–æ–∫–æ–≤–∞ (–ª—ñ–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞)",
                            sets: 3,
                            type: "time",
                            recommended: "30 —Å–µ–∫"
                        },
                        {
                            name: "–ü–ª–∞–Ω–∫–∞ –±–æ–∫–æ–≤–∞ (–ø—Ä–∞–≤–∞ —Å—Ç–æ—Ä–æ–Ω–∞)",
                            sets: 3,
                            type: "time",
                            recommended: "30 —Å–µ–∫"
                        },
                        {
                            name: "–ó–∞–º–∏–Ω–∫–∞ —Ç–∞ —Ä–æ–∑—Ç—è–∂–∫–∞ (10-15 —Ö–≤–∏–ª–∏–Ω)",
                            type: "checkbox"
                        }
                    ]
                },
                {
                    name: "–î–µ–Ω—å 3: –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è",
                    exercises: [
                        {
                            name: "–ö—Ä—É–≥–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è - –ö–æ–ª–æ 1",
                            type: "circuit",
                            circuits: [
                                { name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è", type: "reps", recommended: "5-8" },
                                { name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è –≤—ñ–¥ –ø—ñ–¥–ª–æ–≥–∏", type: "reps", recommended: "10-15" },
                                { name: "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è \"–ø–æ–≤—ñ—Ç—Ä—è–Ω—ñ\"", type: "reps", recommended: "15-20" },
                                { name: "\"–°–∫–µ–ª–µ–ª–∞–∑\" (–∞–ª—å–ø—ñ–Ω—ñ—Å—Ç)", type: "time", recommended: "20-30 —Å–µ–∫" },
                                { name: "–ü—ñ–¥–π–æ–º–∏ –∫–æ–ª—ñ–Ω –¥–æ –≥—Ä—É–¥–µ–π", type: "reps", recommended: "15-20" }
                            ]
                        },
                        {
                            name: "–ö—Ä—É–≥–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è - –ö–æ–ª–æ 2",
                            type: "circuit",
                            circuits: [
                                { name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è", type: "reps" },
                                { name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è", type: "reps" },
                                { name: "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è", type: "reps" },
                                { name: "\"–°–∫–µ–ª–µ–ª–∞–∑\"", type: "time" },
                                { name: "–ü—ñ–¥–π–æ–º–∏ –∫–æ–ª—ñ–Ω", type: "reps" }
                            ]
                        },
                        {
                            name: "–ö—Ä—É–≥–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è - –ö–æ–ª–æ 3",
                            type: "circuit",
                            circuits: [
                                { name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è", type: "reps" },
                                { name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è", type: "reps" },
                                { name: "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è", type: "reps" },
                                { name: "\"–°–∫–µ–ª–µ–ª–∞–∑\"", type: "time" },
                                { name: "–ü—ñ–¥–π–æ–º–∏ –∫–æ–ª—ñ–Ω", type: "reps" }
                            ]
                        },
                        {
                            name: "–ö—Ä—É–≥–æ–≤–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è - –ö–æ–ª–æ 4 (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)",
                            type: "circuit",
                            circuits: [
                                { name: "–ü—ñ–¥—Ç—è–≥—É–≤–∞–Ω–Ω—è", type: "reps" },
                                { name: "–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è", type: "reps" },
                                { name: "–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è", type: "reps" },
                                { name: "\"–°–∫–µ–ª–µ–ª–∞–∑\"", type: "time" },
                                { name: "–ü—ñ–¥–π–æ–º–∏ –∫–æ–ª—ñ–Ω", type: "reps" }
                            ]
                        },
                        {
                            name: "–°—Ç–µ–ø–µ—Ä —ñ–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è",
                            type: "intervals",
                            intervals: [
                                "–Ü–Ω—Ç–µ—Ä–≤–∞–ª 1: 2 —Ö–≤ —à–≤–∏–¥–∫–æ / 1 —Ö–≤ –ø–æ–≤—ñ–ª—å–Ω–æ",
                                "–Ü–Ω—Ç–µ—Ä–≤–∞–ª 2: 2 —Ö–≤ —à–≤–∏–¥–∫–æ / 1 —Ö–≤ –ø–æ–≤—ñ–ª—å–Ω–æ",
                                "–Ü–Ω—Ç–µ—Ä–≤–∞–ª 3: 2 —Ö–≤ —à–≤–∏–¥–∫–æ / 1 —Ö–≤ –ø–æ–≤—ñ–ª—å–Ω–æ",
                                "–Ü–Ω—Ç–µ—Ä–≤–∞–ª 4: 2 —Ö–≤ —à–≤–∏–¥–∫–æ / 1 —Ö–≤ –ø–æ–≤—ñ–ª—å–Ω–æ",
                                "–Ü–Ω—Ç–µ—Ä–≤–∞–ª 5 (—è–∫—â–æ –≤–∏–∫–æ–Ω—É—î—Ç–µ): 2 —Ö–≤ —à–≤–∏–¥–∫–æ / 1 —Ö–≤ –ø–æ–≤—ñ–ª—å–Ω–æ"
                            ]
                        },
                        {
                            name: "–°–∫—Ä—É—á—É–≤–∞–Ω–Ω—è",
                            sets: 3,
                            type: "reps",
                            recommended: "15-20"
                        },
                        {
                            name: "–ó–≤–æ—Ä–æ—Ç–Ω—ñ —Å–∫—Ä—É—á—É–≤–∞–Ω–Ω—è",
                            sets: 3,
                            type: "reps",
                            recommended: "15-20"
                        },
                        {
                            name: "\"–í–µ–ª–æ—Å–∏–ø–µ–¥\"",
                            sets: 3,
                            type: "time",
                            recommended: "20-30 —Å–µ–∫"
                        },
                        {
                            name: "–ó–∞–º–∏–Ω–∫–∞ —Ç–∞ —Ä–æ–∑—Ç—è–∂–∫–∞ (10-15 —Ö–≤–∏–ª–∏–Ω)",
                            type: "checkbox"
                        }
                    ]
                }
            ]
        };

        // File upload functionality
        document.getElementById('csvFileInput').addEventListener('change', handleFileSelect);
        
        const fileUpload = document.getElementById('fileUpload');
        fileUpload.addEventListener('click', () => document.getElementById('csvFileInput').click());
        fileUpload.addEventListener('dragover', handleDragOver);
        fileUpload.addEventListener('drop', handleFileDrop);

        function handleDragOver(e) {
            e.preventDefault();
            fileUpload.classList.add('dragover');
        }

        function handleFileDrop(e) {
            e.preventDefault();
            fileUpload.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processCSVFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processCSVFile(file);
            }
        }

        function processCSVFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csv = e.target.result;
                    const program = parseCSV(csv);
                    currentProgram = program;
                    generateWorkoutProgram(program);
                    alert('‚úÖ –ü—Ä–æ–≥—Ä–∞–º–∞ —Ç—Ä–µ–Ω—É–≤–∞–Ω—å —É—Å–ø—ñ—à–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞!');
                } catch (error) {
                    alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ–±—Ä–æ–±—Ü—ñ CSV —Ñ–∞–π–ª—É: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            
            const program = {
                preWorkout: [],
                postWorkout: [],
                days: {}
            };

            for (let i = 1; i < lines.length; i++) {
                const row = parseCSVRow(lines[i]);
                if (row.length < headers.length) continue;

                const data = {};
                headers.forEach((header, index) => {
                    data[header] = row[index] || '';
                });

                if (data.section === 'pre_workout') {
                    program.preWorkout.push(data.exercise_name);
                } else if (data.section === 'post_workout') {
                    program.postWorkout.push(data.exercise_name);
                } else if (data.section === 'workout') {
                    const dayKey = data.day || 'day1';
                    if (!program.days[dayKey]) {
                        program.days[dayKey] = {
                            name: data.day_name || `Day ${dayKey.replace('day', '')}`,
                            exercises: []
                        };
                    }

                    const exercise = {
                        name: data.exercise_name,
                        type: data.exercise_type || 'reps'
                    };

                    if (data.sets && parseInt(data.sets) > 0) {
                        exercise.sets = parseInt(data.sets);
                    }

                    if (data.recommended) {
                        exercise.recommended = data.recommended;
                    }

                    if (data.exercise_type === 'circuit' && data.circuit_exercises) {
                        exercise.circuits = data.circuit_exercises.split('|').map(ex => {
                            const [name, type, rec] = ex.split(':');
                            return {
                                name: name.trim(),
                                type: type ? type.trim() : 'reps',
                                recommended: rec ? rec.trim() : ''
                            };
                        });
                    }

                    if (data.exercise_type === 'intervals' && data.interval_list) {
                        exercise.intervals = data.interval_list.split('|');
                    }

                    program.days[dayKey].exercises.push(exercise);
                }
            }

            // Convert days object to array
            program.days = Object.values(program.days);

            return program;
        }

        function parseCSVRow(row) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < row.length; i++) {
                const char = row[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current.trim());
            
            return result;
        }

        function generateWorkoutProgram(program) {
            // Generate pre-workout reminders
            const preWorkoutDiv = document.getElementById('preWorkoutReminders');
            preWorkoutDiv.innerHTML = program.preWorkout.map(reminder => `
                <label class="flex items-center space-x-3">
                    <input type="checkbox" class="w-5 h-5 text-blue-600 rounded">
                    <span class="text-gray-700"><strong>${reminder}</strong></span>
                </label>
            `).join('');

            // Generate post-workout reminders
            const postWorkoutDiv = document.getElementById('postWorkoutReminders');
            postWorkoutDiv.innerHTML = program.postWorkout.map(reminder => `
                <label class="flex items-center space-x-3">
                    <input type="checkbox" class="w-5 h-5 text-blue-600 rounded">
                    <span class="text-gray-700"><strong>${reminder}</strong></span>
                </label>
            `).join('');

            // Generate workout tabs
            const tabsDiv = document.getElementById('workoutTabs');
            tabsDiv.innerHTML = program.days.map((day, index) => `
                <button class="workout-tab px-6 py-3 mr-2 mb-2 bg-gray-200 text-gray-700 rounded-lg font-medium transition-colors ${index === 0 ? 'active' : ''}" 
                        onclick="showWorkout(${index + 1})">
                    ${day.name}
                </button>
            `).join('');

            // Generate workout content
            const contentDiv = document.getElementById('workoutContent');
            contentDiv.innerHTML = program.days.map((day, dayIndex) => `
                <div id="day${dayIndex + 1}" class="workout-day ${dayIndex === 0 ? 'active' : ''}">
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-6">${day.name}</h2>
                        ${generateExercises(day.exercises)}
                    </div>
                </div>
            `).join('');
        }

        function generateExercises(exercises) {
            return exercises.map((exercise, index) => {
                const exerciseNumber = index + 1;
                
                if (exercise.type === 'checkbox') {
                    return `
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <label class="flex items-center space-x-3">
                                <input type="checkbox" class="w-5 h-5 text-blue-600 rounded">
                                <span class="text-gray-700">${exercise.name}</span>
                            </label>
                        </div>
                    `;
                } else if (exercise.type === 'circuit') {
                    return `
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">${exerciseNumber}. ${exercise.name}</h3>
                            <div class="p-3 bg-white rounded border">
                                <div class="space-y-2 text-sm">
                                    ${exercise.circuits.map(circuit => `
                                        <div class="flex items-center space-x-2">
                                            <input type="checkbox" class="w-4 h-4 text-blue-600 rounded">
                                            <span>${circuit.name}:</span>
                                            <input type="number" class="w-12 px-1 py-1 border rounded text-center text-xs" placeholder="0">
                                            <span>${circuit.type === 'time' ? '—Å–µ–∫' : '–ø–æ–≤—Ç.'} ${circuit.recommended ? `(${circuit.recommended})` : ''}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `;
                } else if (exercise.type === 'intervals') {
                    return `
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">${exerciseNumber}. ${exercise.name}</h3>
                            <div class="space-y-2">
                                ${exercise.intervals.map(interval => `
                                    <label class="flex items-center space-x-3">
                                        <input type="checkbox" class="w-5 h-5 text-blue-600 rounded">
                                        <span class="text-gray-700">${interval}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    // Regular exercise with sets
                    const sets = exercise.sets || 3;
                    const recommended = exercise.recommended ? ` (${exercise.recommended})` : '';
                    const unit = exercise.type === 'time' ? '—Å–µ–∫—É–Ω–¥' : '–ø–æ–≤—Ç–æ—Ä–µ–Ω—å';
                    
                    return `
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">${exerciseNumber}. ${exercise.name}</h3>
                            <div class="space-y-2">
                                ${Array.from({length: sets}, (_, setIndex) => `
                                    <div class="flex items-center space-x-3">
                                        <input type="checkbox" class="w-5 h-5 text-blue-600 rounded">
                                        <span class="text-gray-700">–ü—ñ–¥—Ö—ñ–¥ ${setIndex + 1}:</span>
                                        <input type="number" class="w-16 px-2 py-1 border rounded text-center" placeholder="0">
                                        <span class="text-gray-700">${unit}${recommended}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function downloadDefaultCSV() {
            const csvContent = generateCSVFromProgram(defaultProgram);
            downloadCSV(csvContent, 'workout_program.csv');
        }

        function generateCSVFromProgram(program) {
            let csv = 'section,day,day_name,exercise_name,exercise_type,sets,recommended,circuit_exercises,interval_list\n';
            
            // Pre-workout
            program.preWorkout.forEach(reminder => {
                csv += `pre_workout,,,,"${reminder}",checkbox,,,,\n`;
            });
            
            // Post-workout
            program.postWorkout.forEach(reminder => {
                csv += `post_workout,,,,"${reminder}",checkbox,,,,\n`;
            });
            
            // Workouts
            program.days.forEach((day, dayIndex) => {
                const dayKey = `day${dayIndex + 1}`;
                day.exercises.forEach(exercise => {
                    let circuitExercises = '';
                    let intervalList = '';
                    
                    if (exercise.circuits) {
                        circuitExercises = exercise.circuits.map(c => 
                            `${c.name}:${c.type}:${c.recommended || ''}`
                        ).join('|');
                    }
                    
                    if (exercise.intervals) {
                        intervalList = exercise.intervals.join('|');
                    }
                    
                    csv += `workout,${dayKey},"${day.name}","${exercise.name}",${exercise.type},${exercise.sets || ''},"${exercise.recommended || ''}","${circuitExercises}","${intervalList}"\n`;
                });
            });
            
            return csv;
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function loadDefaultProgram() {
            currentProgram = defaultProgram;
            generateWorkoutProgram(defaultProgram);
            alert('‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞!');
        }

        function clearProgram() {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ø—Ä–æ–≥—Ä–∞–º—É?')) {
                document.getElementById('preWorkoutReminders').innerHTML = '';
                document.getElementById('postWorkoutReminders').innerHTML = '';
                document.getElementById('workoutTabs').innerHTML = '';
                document.getElementById('workoutContent').innerHTML = '';
                currentProgram = null;
                alert('üóëÔ∏è –ü—Ä–æ–≥—Ä–∞–º–∞ –æ—á–∏—â–µ–Ω–∞!');
            }
        }

        function showWorkout(day) {
            // Hide all workout days
            document.querySelectorAll('.workout-day').forEach(el => {
                el.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.workout-tab').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected workout day
            const dayElement = document.getElementById('day' + day);
            if (dayElement) {
                dayElement.classList.add('active');
            }
            
            // Add active class to selected tab
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            currentActiveDay = day;
        }

        function getWorkoutData() {
            const data = {};
            
            // Save all checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach((checkbox, index) => {
                data[`checkbox_${index}`] = checkbox.checked;
            });
            
            // Save all number inputs
            document.querySelectorAll('input[type="number"]').forEach((input, index) => {
                data[`number_${index}`] = input.value;
            });
            
            return data;
        }

        function setWorkoutData(data) {
            // Load checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach((checkbox, index) => {
                if (data[`checkbox_${index}`] !== undefined) {
                    checkbox.checked = data[`checkbox_${index}`];
                }
            });
            
            // Load number inputs
            document.querySelectorAll('input[type="number"]').forEach((input, index) => {
                if (data[`number_${index}`] !== undefined) {
                    input.value = data[`number_${index}`];
                }
            });
        }

        function saveWorkout() {
            const date = document.getElementById('workoutDate').value;
            if (!date) {
                alert('‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è!');
                return;
            }

            const workoutData = getWorkoutData();
            const allWorkouts = JSON.parse(localStorage.getItem('workoutHistory') || '{}');
            
            // Get current active workout day
            const activeDay = document.querySelector('.workout-day.active')?.id || `day${currentActiveDay}`;
            
            if (!allWorkouts[date]) {
                allWorkouts[date] = {};
            }
            
            const activeTabText = document.querySelector('.workout-tab.active')?.textContent?.trim() || `–î–µ–Ω—å ${currentActiveDay}`;
            
            allWorkouts[date][activeDay] = {
                data: workoutData,
                timestamp: new Date().toISOString(),
                workoutType: activeTabText
            };
            
            localStorage.setItem('workoutHistory', JSON.stringify(allWorkouts));
            alert(`‚úÖ –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ –¥–ª—è ${formatDate(date)}!`);
        }

        function loadWorkout() {
            const date = document.getElementById('workoutDate').value;
            if (!date) {
                alert('‚ö†Ô∏è –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–±–µ—Ä—ñ—Ç—å –¥–∞—Ç—É –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è!');
                return;
            }

            const allWorkouts = JSON.parse(localStorage.getItem('workoutHistory') || '{}');
            const activeDay = document.querySelector('.workout-day.active')?.id || `day${currentActiveDay}`;
            
            if (allWorkouts[date] && allWorkouts[date][activeDay]) {
                setWorkoutData(allWorkouts[date][activeDay].data);
                alert(`üìÇ –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–ª—è ${formatDate(date)}!`);
            } else {
                alert(`‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –¥–ª—è ${formatDate(date)}!`);
            }
        }

        function showHistory() {
            const allWorkouts = JSON.parse(localStorage.getItem('workoutHistory') || '{}');
            const historyContent = document.getElementById('historyContent');
            
            if (Object.keys(allWorkouts).length === 0) {
                historyContent.innerHTML = '<p class="text-gray-500 text-center py-8">üì≠ –Ü—Å—Ç–æ—Ä—ñ—è —Ç—Ä–µ–Ω—É–≤–∞–Ω—å –ø–æ—Ä–æ–∂–Ω—è</p>';
            } else {
                let historyHTML = '';
                
                // Sort dates in descending order (newest first)
                const sortedDates = Object.keys(allWorkouts).sort((a, b) => new Date(b) - new Date(a));
                
                sortedDates.forEach(date => {
                    const dayWorkouts = allWorkouts[date];
                    const workoutCount = Object.keys(dayWorkouts).length;
                    
                    historyHTML += `
                        <div class="history-item bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="text-xl font-semibold text-gray-800">${formatDate(date)}</h3>
                                <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm">
                                    ${workoutCount} —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è
                                </span>
                            </div>
                            <div class="space-y-2">
                    `;
                    
                    Object.keys(dayWorkouts).forEach(dayId => {
                        const workout = dayWorkouts[dayId];
                        const completedExercises = Object.values(workout.data).filter(val => val === true).length;
                        const totalInputs = Object.values(workout.data).filter(val => val !== '' && val !== false).length;
                        
                        historyHTML += `
                            <div class="flex justify-between items-center bg-white rounded p-3">
                                <div>
                                    <span class="font-medium text-gray-700">${workout.workoutType}</span>
                                    <div class="text-sm text-gray-500">
                                        ‚úÖ ${completedExercises} –≤–∏–∫–æ–Ω–∞–Ω–æ | üìä ${totalInputs} –∑–∞–ø–∏—Å—ñ–≤
                                    </div>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="loadSpecificWorkout('${date}', '${dayId}')" 
                                            class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">
                                        üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏
                                    </button>
                                    <button onclick="deleteWorkout('${date}', '${dayId}')" 
                                            class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    historyHTML += `
                            </div>
                        </div>
                    `;
                });
                
                historyContent.innerHTML = historyHTML;
            }
            
            document.getElementById('historyModal').classList.remove('hidden');
        }

        function loadSpecificWorkout(date, dayId) {
            const allWorkouts = JSON.parse(localStorage.getItem('workoutHistory') || '{}');
            
            if (allWorkouts[date] && allWorkouts[date][dayId]) {
                // Switch to the correct day
                const dayNumber = parseInt(dayId.replace('day', ''));
                showWorkout(dayNumber);
                
                // Set the date
                document.getElementById('workoutDate').value = date;
                
                // Load the data
                setWorkoutData(allWorkouts[date][dayId].data);
                
                closeHistory();
                alert(`üìÇ –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –¥–ª—è ${formatDate(date)}!`);
            }
        }

        function deleteWorkout(date, dayId) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è?')) {
                const allWorkouts = JSON.parse(localStorage.getItem('workoutHistory') || '{}');
                
                if (allWorkouts[date] && allWorkouts[date][dayId]) {
                    delete allWorkouts[date][dayId];
                    
                    // If no more workouts for this date, delete the date entry
                    if (Object.keys(allWorkouts[date]).length === 0) {
                        delete allWorkouts[date];
                    }
                    
                    localStorage.setItem('workoutHistory', JSON.stringify(allWorkouts));
                    showHistory(); // Refresh the history view
                    alert('üóëÔ∏è –¢—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ!');
                }
            }
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.add('hidden');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('uk-UA', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // Initialize with default program
        window.addEventListener('load', () => {
            loadDefaultProgram();
        });
    </script>
<script>window.parent.postMessage({ action: "ready" }, "*"); 
 
window.console = new Proxy(console, {
  get(target, prop) {
    if (['log', 'warn', 'error'].includes(prop)) {
      return new Proxy(target[prop], {
        apply(fn, thisArg, args) {
          fn.apply(thisArg, args);
          window.parent.postMessage({ action: 'console', 
            type: prop, 
            args: args.map((arg) => {
              try {
                return JSON.stringify(arg).replace(/^["']|["']$/g, '');
              } catch (e) {
                return arg;
              }
            }) 
          }, '*');
        }
      });
    }
    return target[prop];
  }
});
</script></body>
</html>
